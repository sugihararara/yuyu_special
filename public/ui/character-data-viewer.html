<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Data Viewer - 幽☆遊☆白書 特別篇</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #111;
            font-family: "MS Gothic", monospace;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 28px;
            color: #ffcc00;
            margin-bottom: 20px;
        }

        .character-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
        }

        .char-btn {
            background: #222;
            border: 1px solid #444;
            color: #fff;
            padding: 12px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .char-btn:hover {
            background: #333;
            border-color: #ffcc00;
        }

        .char-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .char-btn:disabled:hover {
            background: #222;
            border-color: #444;
        }

        .char-btn.active {
            background: #ffcc00;
            color: #000;
            font-weight: bold;
        }

        .data-display {
            background: #1a1a1a;
            border: 2px solid #444;
            padding: 20px;
            display: none;
        }

        .data-display.show {
            display: block;
        }

        .char-name {
            font-size: 24px;
            color: #ffcc00;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            color: #66ccff;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .stat-item {
            background: #222;
            padding: 10px;
            border-left: 3px solid #ffcc00;
        }

        .stat-label {
            color: #888;
            font-size: 12px;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: bold;
        }

        .moves-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .moves-table th,
        .moves-table td {
            border: 1px solid #444;
            padding: 8px;
            text-align: left;
        }

        .moves-table th {
            background: #222;
            color: #ffcc00;
        }

        .moves-table tr:nth-child(even) {
            background: #1a1a1a;
        }

        .moves-table tr:nth-child(odd) {
            background: #0f0f0f;
        }

        .error {
            background: #ff3333;
            color: #fff;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Character Data Viewer</h1>

        <div class="character-buttons" id="characterButtons">
            <!-- Buttons will be generated by JavaScript -->
        </div>

        <div class="data-display" id="dataDisplay">
            <div id="characterData"></div>
        </div>
    </div>

    <script type="module">
        // Character list (all 19 characters, but only some have data)
        const characters = [
            { id: 'yusuke', name: '幽助', available: true },
            { id: 'kuwabara', name: '桑原', available: true },
            { id: 'kurama1', name: '蔵馬', available: false },
            { id: 'hiei', name: '飛影', available: true },
            { id: 'genkai', name: '幻海', available: false },
            { id: 'genkai_young', name: '幻海（若）', available: false },
            { id: 'suzuku', name: '鈴駒', available: false },
            { id: 'touya', name: '凍矢', available: false },
            { id: 'jin', name: '陣', available: false },
            { id: 'shishiwakamaru', name: '死々若丸', available: false },
            { id: 'karasu', name: '鴉', available: false },
            { id: 'bui', name: '武威', available: false },
            { id: 'toguro_elder', name: '戸愚呂兄', available: false },
            { id: 'toguro_younger', name: '戸愚呂弟', available: false },
            { id: 'toguro_100', name: '100%', available: false },
            { id: 'gourmet', name: '神谷', available: false },
            { id: 'makintaro', name: '刃霧', available: false },
            { id: 'itsuki', name: '樹', available: false },
            { id: 'sensui', name: '仙水', available: false },
        ];

        // Generate buttons
        const buttonsContainer = document.getElementById('characterButtons');
        characters.forEach(char => {
            const btn = document.createElement('button');
            btn.className = 'char-btn';
            btn.textContent = char.name;
            btn.disabled = !char.available;
            if (char.available) {
                btn.onclick = () => loadCharacter(char.id, char.name);
            }
            buttonsContainer.appendChild(btn);
        });

        // Load and display character data
        async function loadCharacter(charId, charName) {
            const dataDisplay = document.getElementById('dataDisplay');
            const characterDataDiv = document.getElementById('characterData');

            // Show loading
            characterDataDiv.innerHTML = '<div class="loading">Loading...</div>';
            dataDisplay.classList.add('show');

            // Highlight active button
            document.querySelectorAll('.char-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            try {
                const basePath = `/data/characters/${charId}`;

                // Load all 3 files in parallel
                const [statsResponse, movesResponse, framesResponse] = await Promise.all([
                    fetch(`${basePath}/stats.json`),
                    fetch(`${basePath}/moves.json`),
                    fetch(`${basePath}/frames.json`),
                ]);

                // Check responses
                if (!statsResponse.ok) {
                    throw new Error(`Failed to load stats.json: ${statsResponse.status}`);
                }
                if (!movesResponse.ok) {
                    throw new Error(`Failed to load moves.json: ${movesResponse.status}`);
                }
                if (!framesResponse.ok) {
                    throw new Error(`Failed to load frames.json: ${framesResponse.status}`);
                }

                // Parse JSON
                const statsData = await statsResponse.json();
                const movesData = await movesResponse.json();
                const framesData = await framesResponse.json();

                // Combine into character data
                const data = {
                    ...statsData,
                    moves: movesData.map(move => ({
                        ...move,
                        frames: framesData[move.id]
                    }))
                };

                // Display data
                displayCharacterData(data);
            } catch (error) {
                characterDataDiv.innerHTML = `
                    <div class="error">
                        <strong>Error loading ${charName}:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }

        // Display character data
        function displayCharacterData(data) {
            const characterDataDiv = document.getElementById('characterData');

            const html = `
                <div class="char-name">${data.name} (${data.nameEn})</div>

                <div class="section">
                    <div class="section-title">Base Stats</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Defense</div>
                            <div class="stat-value">${(data.stats.defense * 100).toFixed(1)}%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Real HP</div>
                            <div class="stat-value">${data.stats.realHp}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Balance Defense</div>
                            <div class="stat-value">${(data.stats.balanceDefense * 100).toFixed(1)}%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Real Balance</div>
                            <div class="stat-value">${data.stats.realBalance}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Airtime</div>
                            <div class="stat-value">${data.stats.airtime}F</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Knockdown Duration (No Mashing)</div>
                            <div class="stat-value">${data.stats.knockdownDuration}F</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Knockdown (30/sec Mashing)</div>
                            <div class="stat-value">${data.stats.knockdownDuration30PerSec}F</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Knockdown (60/sec Mashing)</div>
                            <div class="stat-value">${data.stats.knockdownDuration60PerSec}F</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Airtime Touki</div>
                            <div class="stat-value">${data.stats.airtimeTouki} bars</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Powered Punch Rate</div>
                            <div class="stat-value">${(data.stats.poweredPunchRate * 100).toFixed(1)}%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Clean Hit Rate</div>
                            <div class="stat-value">${(data.stats.cleanHitRate * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Moves (${data.moves.length} total)</div>
                    <table class="moves-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Command</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Success</th>
                                <th>Evasion</th>
                                <th>Power</th>
                                <th>Balance</th>
                                <th>Reiki</th>
                                <th>Variant</th>
                                <th>森</th>
                                <th>暗</th>
                                <th>断</th>
                                <th>時</th>
                                <th>Prep F</th>
                                <th>Act F</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.moves.map(move => {
                                const hasAerial = move.frames && move.frames.aerial;
                                const groundRow = `
                                    <tr>
                                        <td rowspan="${hasAerial ? 2 : 1}">${move.id}</td>
                                        <td rowspan="${hasAerial ? 2 : 1}">${move.command}</td>
                                        <td rowspan="${hasAerial ? 2 : 1}">${move.name}</td>
                                        <td rowspan="${hasAerial ? 2 : 1}">${move.type}</td>
                                        <td rowspan="${hasAerial ? 2 : 1}">${move.successRate}</td>
                                        <td rowspan="${hasAerial ? 2 : 1}">${move.evasionRate}</td>
                                        <td rowspan="${hasAerial ? 2 : 1}">${move.power}</td>
                                        <td rowspan="${hasAerial ? 2 : 1}">${move.balanceDrain}</td>
                                        <td rowspan="${hasAerial ? 2 : 1}">${move.reikiCost}</td>
                                        <td style="color: #66ccff;">地</td>
                                        <td>${move.frames.ground.prepTransition.forest}F</td>
                                        <td>${move.frames.ground.prepTransition.dark}F</td>
                                        <td>${move.frames.ground.prepTransition.guillotine}F</td>
                                        <td>${move.frames.ground.prepTransition.timegap}F</td>
                                        <td>${move.frames.ground.preparation}F</td>
                                        <td>${move.frames.ground.activation}F</td>
                                    </tr>
                                `;
                                const aerialRow = hasAerial ? `
                                    <tr style="background: #1a2a3a !important;">
                                        <td style="color: #ff99cc;">空</td>
                                        <td>${move.frames.aerial.prepTransition.forest}F</td>
                                        <td>${move.frames.aerial.prepTransition.dark}F</td>
                                        <td>${move.frames.aerial.prepTransition.guillotine}F</td>
                                        <td>${move.frames.aerial.prepTransition.timegap}F</td>
                                        <td>${move.frames.aerial.preparation}F</td>
                                        <td>${move.frames.aerial.activation}F</td>
                                    </tr>
                                ` : '';
                                return groundRow + aerialRow;
                            }).join('')}
                        </tbody>
                    </table>
                </div>

                ${data.canTransform ? `
                    <div class="section">
                        <div class="section-title">Transformation</div>
                        <div class="stat-item">
                            <div class="stat-label">Can transform into</div>
                            <div class="stat-value">${data.transformInto}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Condition</div>
                            <div class="stat-value">${data.transformCondition}</div>
                        </div>
                    </div>
                ` : ''}
            `;

            characterDataDiv.innerHTML = html;
        }
    </script>
</body>
</html>
