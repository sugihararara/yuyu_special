<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幽☆遊☆白書 特別篇 - UI モックアップ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            font-family: "MS Gothic", monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            overflow: auto;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0px;
            max-height: 90vh;
            overflow: visible;
        }

        .game-screen {
            width: 512px;
            height: 448px;
            background: #000;
            position: relative;
            border: 2px solid #333;
        }

        /* バトルフィールド */
        .battlefield {
            width: 100%;
            height: 240px;  /* 高さを減らして間隔を詰める */
            background: linear-gradient(to bottom, #4a3030 0%, #2a1818 100%);
            position: relative;
            overflow: hidden;
        }

        /* キャラクター配置エリア */
        .character-area {
            position: absolute;
            bottom: 40px;  /* 下に文字枠用のスペースを確保 */
            width: 100%;
            height: 160px;
            padding: 0;
        }
        
        /* 分割モード用のスタイル */
        .character-area.split-mode {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 40px;
        }
        
        /* 統合モード用のスタイル */
        .character-area.single-mode {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 20px;
        }
        
        .character {
            width: 120px;
            height: 140px;
            background: #666;
            border: 2px solid #999;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 24px;
            font-weight: bold;
            position: relative;
        }
        
        /* 統合モード用の背景画像エリア */
        .single-image {
            width: 100%;
            height: 140px;  /* キャラクターと同じ高さ */
            background: #444;
            border: 2px solid #999;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 18px;
        }
        
        /* メッセージボックス */
        .message-box {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 35px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 1px solid #666;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 14px;
            font-family: "MS Gothic", monospace;
            padding: 5px;
        }

        .character::after {
            content: 'キャラ画像をここに配置';
            position: absolute;
            bottom: -20px;
            font-size: 10px;
            color: #888;
            white-space: nowrap;
        }

        /* 体力メーター */
        .hp-bar-container {
            position: absolute;
            top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
        }

        .hp-bar {
            width: 200px;
            height: 16px;
            background: #000;
            border: 2px solid #fff;
            position: relative;
        }

        .hp-bar-inner {
            position: absolute;
            top: 0;
            height: 100%;
        }

        .hp-bar-yellow {
            background: #ffff00;
            width: 100%;
            z-index: 1;
        }

        .hp-bar-red {
            background: #ff0000;
            width: 50%;
            z-index: 2;
        }

        .hp-bar.p2 {
            transform: scaleX(-1);
        }

        /* 闘気メーター */

        .touki-meter {
            width: 180px;
            height: 12px;
            background: #000;
            border: 2px solid #fff;
            position: relative;
            overflow: hidden;  /* はみ出し防止 */
        }

        .touki-meter-fill {
            height: 100%;
            background: #ff0000;  /* 赤色で固定 */
            width: 0px;  /* pxで指定 */
            position: absolute;
            top: 0;
        }

        /* 1Pは右端から左へ伸びる */
        .touki-meter.p1 .touki-meter-fill {
            right: 0;
        }

        /* 2Pは左端から右へ伸びる */
        .touki-meter.p2 .touki-meter-fill {
            left: 0;
        }

        /* バランスメーター */
        .balance-meter-container {
            position: absolute;
            top: 55px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
        }

        .balance-meter {
            width: 160px;
            height: 8px;
            background: #000;
            border: 1px solid #fff;
            position: relative;
        }

        .balance-meter-fill {
            height: 100%;
            background: #00ffff;  /* シアンに変更 */
            width: 100%;
            /* 重要：JSアニメーションと意図的に併用して独特の動きを実現 */
            /* 途中で詰まって最後にきゅっと伸びる格ゲーらしい演出 */
            transition: width 0.3s ease;
        }

        /* UIパネル部分 */
        .ui-panel {
            width: 100%;
            height: 210px;  /* 高さを増やす */
            background: #1a1a1a;
            border-top: 3px solid #666;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        /* プレイヤー情報エリア */
        .player-info {
            width: 180px;
            height: 100%;
            border: 2px solid #444;
            background: #0a0a0a;
            padding: 5px;
        }

        /* アイテムストック */
        .item-stock {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .item-stock-label {
            color: #fff;
            font-size: 10px;
        }

        .item-slot {
            width: 60px;
            height: 40px;
            border: 2px solid #666;
            background: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 16px;
            font-weight: bold;
        }

        .item-slot.empty {
            color: #444;
        }

        /* 霊気ゲージ */
        .reiki-gauge {
            margin-top: 10px;
            width: 100%;
            max-width: 100%;
        }

        .reiki-label {
            color: #ffcc00;  /* 黄色に変更 */
            font-size: 12px;
            margin-bottom: 3px;
        }

        .reiki-bar {
            width: 129px;  /* 内部123px(セル75px+間隔48px) + padding4px + border2px = 129px */
            max-width: 100%;
            height: 20px;
            background: #000;
            border: 1px solid #ffcc00;  /* 黄色の枠 */
            display: flex;
            gap: 0;  /* marginで制御するのでgapは0 */
            padding: 2px;  /* padding左右2px */
            box-sizing: border-box;  /* paddingとborderを含む */
            overflow: hidden;
            justify-content: flex-start;  /* 左寄せ */
        }

        .reiki-cell {
            width: 3px;  /* セルを小さく */
            height: 100%;
            background: #333;
            opacity: 0.3;
            border: none;
            margin: 0 1px;  /* 左右に1pxずつ（合計2px）の間隔 */
            flex-shrink: 0;  /* 縮小防止 */
        }

        .reiki-cell:first-child {
            margin-left: 0;  /* 最初のセルは左マージンなし */
        }
        
        .reiki-cell:last-child {
            margin-right: 0;  /* 最後のセルは右マージンなし */
        }
        
        .reiki-cell.filled {
            background: linear-gradient(to bottom, 
                #ffa500 0%,      /* オレンジ */
                #ffffcc 20%,     /* 白っぽい黄色 */
                #ffffee 50%,     /* より白い黄色 */
                #ffffcc 80%,     /* 白っぽい黄色 */
                #ffa500 100%     /* オレンジ */
            );
            opacity: 1;
            box-shadow: 0 0 3px #ffcc00;
            border: none;  /* borderを削除 */
        }
        
        /* 霊気セルの点滅アニメーション */
        @keyframes reiki-blink {
            0% { opacity: 1; box-shadow: 0 0 3px #ffcc00; }
            50% { opacity: 0.2; box-shadow: none; }
            100% { opacity: 1; box-shadow: 0 0 3px #ffcc00; }
        }
        
        .reiki-cell.blinking {
            animation: reiki-blink 0.3s ease-in-out;
        }

        /* 1Pは左から、2Pは右から埋まる */
        .player-info.p1 .reiki-bar {
            flex-direction: row;
        }

        .player-info.p2 .reiki-bar {
            flex-direction: row-reverse;
        }

        /* 霊界水晶玉 */
        .crystal-ball-container {
            width: 120px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .crystal-ball {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #ff00ff, #800080);
            border: 3px solid #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 20px #ff00ff;
            position: relative;
        }

        .crystal-content {
            color: #fff;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 10px #fff;
        }

        .crystal-label {
            color: #fff;
            font-size: 10px;
            margin-top: 5px;
        }

        /* コマンドインジケーター */
        .command-indicator {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 12px;
            background: rgba(0,0,0,0.7);
            padding: 5px 10px;
            border: 1px solid #666;
        }

        /* デバッグ情報 */
        .debug-info {
            position: absolute;
            top: 5px;
            right: 5px;
            color: #0f0;
            font-size: 10px;
            font-family: monospace;
        }

        /* アニメーション */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .active-player {
            animation: pulse 1s infinite;
        }

        /* メーターのラベル */
        .meter-label {
            position: absolute;
            top: -15px;
            left: 0;
            color: #fff;
            font-size: 10px;
        }

        /* プレイヤーラベル */
        .player-label {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            background: #000;
            padding: 2px 8px;
            border: 1px solid #fff;
        }

        /* 詳細情報オーバーレイ */
        .info-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            border: 1px solid #666;
            padding: 10px;
            color: #fff;
            font-size: 11px;
            display: none;
        }

        .info-overlay.show {
            display: block;
        }

        .info-overlay h3 {
            color: #0ff;
            margin-bottom: 5px;
        }

        .info-overlay ul {
            list-style: none;
        }

        .info-overlay li {
            margin: 2px 0;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- ゲーム画面全体のコンテナー（スケール変更用） -->
    <div id="game-screen-container" style="
        transform-origin: top left;  /* 左上を基準に拡大 */
        transform: scale(1);          /* デフォルトは1倍 */
        transition: transform 0.3s ease;  /* スムーズな拡大縮小アニメーション */
    ">
    <div class="game-screen">
        <!-- バトルフィールド -->
        <div class="battlefield">
            <!-- HP/闘気/バランスメーター -->
            <div class="hp-bar-container">
                <div class="hp-bar p1">
                    <span class="meter-label">HP</span>
                    <div class="hp-bar-inner hp-bar-yellow"></div>
                    <div class="hp-bar-inner hp-bar-red"></div>
                </div>
                <div class="hp-bar p2">
                    <div class="hp-bar-inner hp-bar-yellow"></div>
                    <div class="hp-bar-inner hp-bar-red"></div>
                </div>
            </div>

            <!-- キャラクター配置 -->
            <div class="character-area split-mode" id="character-area">
                <div class="character">
                    １Ｐ
                </div>
                <div class="character">
                    ２Ｐ
                </div>
            </div>
            
            <!-- メッセージボックス -->
            <div class="message-box" id="message-box">
                ここにメッセージが表示されます
            </div>
        </div>

        <!-- UIパネル -->
        <div class="ui-panel">
            <!-- 上段：闘気とバランスメーター -->
            <div style="width: 100%; display: flex; justify-content: space-between; margin-bottom: 10px; padding: 5px 0;">
                <!-- 1P側メーター -->
                <div style="flex: 1; padding: 0 5px;">
                    <div class="touki-meter p1" style="width: 100%; height: 12px; background: #000; border: 2px solid #fff; position: relative;">
                        <span style="position: absolute; top: -15px; left: 0; color: #fff; font-size: 10px;">闘気</span>
                        <div class="touki-meter-fill" id="touki1" style="height: 100%; background: #ff0000; width: 0px; position: absolute; top: 0; right: 0;"></div>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 20px;">
                        <div class="balance-meter p1" style="flex: 1; height: 8px; background: #000; border: 1px solid #fff; position: relative;">
                            <span style="position: absolute; top: -15px; left: 0; color: #fff; font-size: 10px;">バランス</span>
                            <div class="balance-meter-fill" style="height: 100%; background: #00ffff; width: 100%;"></div>
                        </div>
                        <!-- 1P入力受付ランプ -->
                        <div id="input-lamp-1p" style="width: 20px; height: 20px; border-radius: 50%; background: #0080ff; border: 2px solid #fff; margin-left: 10px; box-shadow: 0 0 10px #0080ff;"></div>
                    </div>
                </div>
                
                <!-- 中央の空白 -->
                <div style="width: 50px;"></div>
                
                <!-- 2P側メーター -->
                <div style="flex: 1; padding: 0 5px;">
                    <div class="touki-meter p2" style="width: 100%; height: 12px; background: #000; border: 2px solid #fff; position: relative;">
                        <span style="position: absolute; top: -15px; right: 0; color: #fff; font-size: 10px;">闘気</span>
                        <div class="touki-meter-fill" id="touki2" style="height: 100%; background: #ff0000; width: 0px; position: absolute; top: 0; left: 0;"></div>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 20px;">
                        <!-- 2P入力受付ランプ -->
                        <div id="input-lamp-2p" style="width: 20px; height: 20px; border-radius: 50%; background: #0080ff; border: 2px solid #fff; margin-right: 10px; box-shadow: 0 0 10px #0080ff;"></div>
                        <div class="balance-meter p2" style="flex: 1; height: 8px; background: #000; border: 1px solid #fff; position: relative;">
                            <span style="position: absolute; top: -15px; right: 0; color: #fff; font-size: 10px;">バランス</span>
                            <div class="balance-meter-fill" style="height: 100%; background: #00ffff; width: 100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 下段：既存のプレイヤー情報 -->
            <div style="display: flex; justify-content: center; align-items: center; width: 100%; gap: 10px;">
                <!-- 1Pエリア -->
                <div class="player-info p1" style="
                    display: grid;
                    grid-template-columns: 1fr 40px;
                    grid-template-rows: auto auto;
                    gap: 2px;
                    align-items: start;
                    padding-right: 5px;
                ">
                    <!-- アイテム枠（左上） -->
                    <div class="item-stock" style="grid-column: 1; grid-row: 1; justify-self: end;">
                        <div class="item-stock-label">アイテム</div>
                        <div class="item-slot">愛(大)</div>
                    </div>
                    
                    <!-- 1P入力可能ランプ（右上） -->
                    <div class="input-buttons-lamp" id="input-buttons-1p" style="
                        grid-column: 2;
                        grid-row: 1;
                        width: 35px;
                        height: 35px;
                        position: relative;
                        justify-self: end;
                    ">
                        <!-- 上（Y:青） -->
                        <div id="btn-1p-y" style="position: absolute; top: 2px; left: 50%; transform: translateX(-50%); width: 10px; height: 10px; border-radius: 50%; background: #0080ff; border: 1px solid #fff;"></div>
                        <!-- 左（X:緑） -->
                        <div id="btn-1p-x" style="position: absolute; top: 50%; left: 2px; transform: translateY(-50%); width: 10px; height: 10px; border-radius: 50%; background: #00ff00; border: 1px solid #fff;"></div>
                        <!-- 下（B:黄） -->
                        <div id="btn-1p-b" style="position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%); width: 10px; height: 10px; border-radius: 50%; background: #ffff00; border: 1px solid #fff;"></div>
                        <!-- 右（A:赤） -->
                        <div id="btn-1p-a" style="position: absolute; top: 50%; right: 2px; transform: translateY(-50%); width: 10px; height: 10px; border-radius: 50%; background: #ff0000; border: 1px solid #fff;"></div>
                    </div>
                    
                    <!-- 霊気ゲージ（下段、両列にまたがる） -->
                    <div class="reiki-gauge" style="grid-column: 1 / 3; grid-row: 2; width: 100%;">
                        <div class="reiki-label">霊気ゲージ (20/25)</div>
                        <div class="reiki-bar">
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                            <div class="reiki-cell"></div>
                            <div class="reiki-cell"></div>
                            <div class="reiki-cell"></div>
                            <div class="reiki-cell"></div>
                            <div class="reiki-cell"></div>
                        </div>
                    </div>
                </div>

            <!-- 霊界水晶玉 -->
            <div class="crystal-ball-container">
                <div class="crystal-ball">
                    <div class="crystal-content">●●●</div>
                </div>
                <div class="crystal-label">霊界水晶玉</div>
            </div>

            <!-- 2Pエリア -->
            <div class="player-info p2" style="
                display: grid;
                grid-template-columns: 40px 1fr;
                grid-template-rows: auto auto;
                gap: 2px;
                align-items: start;
                padding-left: 5px;
            ">
                <!-- 2P入力可能ランプ（左上） -->
                <div class="input-buttons-lamp" id="input-buttons-2p" style="
                    grid-column: 1;
                    grid-row: 1;
                    width: 35px;
                    height: 35px;
                    position: relative;
                    justify-self: start;
                ">
                    <!-- 上（Y:青） -->
                    <div id="btn-2p-y" style="position: absolute; top: 2px; left: 50%; transform: translateX(-50%); width: 10px; height: 10px; border-radius: 50%; background: #0080ff; border: 1px solid #fff;"></div>
                    <!-- 左（X:緑） -->
                    <div id="btn-2p-x" style="position: absolute; top: 50%; left: 2px; transform: translateY(-50%); width: 10px; height: 10px; border-radius: 50%; background: #00ff00; border: 1px solid #fff;"></div>
                    <!-- 下（B:黄） -->
                    <div id="btn-2p-b" style="position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%); width: 10px; height: 10px; border-radius: 50%; background: #ffff00; border: 1px solid #fff;"></div>
                    <!-- 右（A:赤） -->
                    <div id="btn-2p-a" style="position: absolute; top: 50%; right: 2px; transform: translateY(-50%); width: 10px; height: 10px; border-radius: 50%; background: #ff0000; border: 1px solid #fff;"></div>
                </div>
                
                <!-- アイテム枠（右上） -->
                <div class="item-stock" style="grid-column: 2; grid-row: 1;">
                    <div class="item-stock-label">アイテム</div>
                    <div class="item-slot empty">---</div>
                </div>
                
                <!-- 霊気ゲージ（下段、両列にまたがる） -->
                <div class="reiki-gauge" style="grid-column: 1 / 3; grid-row: 2; width: 100%;">
                    <div class="reiki-label">霊気ゲージ (12/25)</div>
                    <div class="reiki-bar">
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell filled"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                        <div class="reiki-cell"></div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
    <!-- ゲーム画面コンテナー終了 -->

        <!-- コマンド表示 -->
        <!-- <div class="command-indicator">
            十字キー：選択 | A：決定 | B：キャンセル
        </div> -->

        <!-- デバッグ情報 -->
        <div class="debug-info">
            FPS: 60 | State: READY
        </div>

        <!-- 情報オーバーレイ -->
        <div class="info-overlay" id="infoOverlay">
            <h3>画像差し替えガイド</h3>
            <ul>
                <li>• .character クラス内に画像配置</li>
                <li>• 推奨サイズ: 120x140px</li>
                <li>• 背景は透過PNG推奨</li>
                <li>• アイテムアイコン: 30x30px</li>
            </ul>
        </div>
    </div>

    <!-- デバッグコントロールパネル（開発用） -->
    <div id="debug-control-panel" style="
        width: 512px;
        background: rgba(20, 20, 20, 0.95);
        border: 2px solid #666;
        border-top: none;
        padding: 10px;
        color: #fff;
        font-family: monospace;
        font-size: 11px;
        margin-top: -2px;
    ">
        <div style="text-align: center; margin-bottom: 8px;">
            <strong style="color: #0ff;">= デバッグコントロール =</strong>
        </div>

        <!-- 画面スケール調整（最上部） -->
        <div style="margin-bottom: 8px; padding: 4px; border: 1px solid #444; background: #2a2a2a;">
            <strong style="color: #ff0;">画面スケール:</strong>
            <button id="scale-0.5x">0.5x</button>
            <button id="scale-1x" style="background: #060;">1x</button>
            <button id="scale-1.5x">1.5x</button>
            <button id="scale-2x">2x</button>
            <button id="scale-3x">3x</button>
            <span style="margin-left: 10px; color: #888;">現在: <span id="current-scale">1.0</span>倍</span>
        </div>

        <!-- HP調整（上部） -->
        <div style="margin-bottom: 8px; padding: 4px; border: 1px solid #444;">
            <strong style="color: #ff0;">HP:</strong><br>
            1P: <input type="number" id="hp1-input" min="0" max="100" value="100" style="width: 50px; background: #222; color: #fff; border: 1px solid #666;">%
            <button id="hp1-set">設定</button>
            <button id="hp1-0">0%</button>
            <button id="hp1-50">50%</button>
            <button id="hp1-100">100%</button>
            <span style="margin-left: 5px;">現在: <span id="hp1-value">100</span>%</span><br>
            2P: <input type="number" id="hp2-input" min="0" max="100" value="100" style="width: 50px; background: #222; color: #fff; border: 1px solid #666;">%
            <button id="hp2-set">設定</button>
            <button id="hp2-0">0%</button>
            <button id="hp2-50">50%</button>
            <button id="hp2-100">100%</button>
            <span style="margin-left: 5px;">現在: <span id="hp2-value">100</span>%</span>
        </div>

        <!-- 画面モード切替（中央上） -->
        <div style="margin-bottom: 8px; padding: 4px; border: 1px solid #444;">
            <strong style="color: #ff0;">画面モード:</strong>
            <button id="mode-split">分割モード</button>
            <button id="mode-single">統合モード</button>
            <button id="mode-bg-test">テスト背景</button><br>
            <strong style="color: #ff0;">点滅:</strong>
            <button id="blink-1p">1P点滅</button>
            <button id="blink-2p">2P点滅</button>
            <button id="blink-none">点滅なし</button>
        </div>
        
        <!-- メッセージ設定（中央下） -->
        <div style="margin-bottom: 8px; padding: 4px; border: 1px solid #444;">
            <strong style="color: #ff0;">メッセージ:</strong><br>
            <input type="text" id="message-input" style="width: 300px; background: #222; color: #fff; border: 1px solid #666;" placeholder="メッセージを入力">
            <button id="message-set">反映</button>
            <button id="message-clear">クリア</button><br>
            <button id="message-sample1">サンプル1</button>
            <button id="message-sample2">サンプル2</button>
        </div>

        <!-- 闘気コントロール（下部上） -->
        <div style="margin-bottom: 8px; padding: 4px; border: 1px solid #444;">
            <strong style="color: #ff0;">闘気:</strong><br>
            1P: <button id="touki1-charge" style="background: #400;">押して溜める</button>
            <button id="touki1-reset">リセット</button>
            <button id="touki1-set50">50%</button>
            <button id="touki1-set100">100%</button>
            <span style="margin-left: 5px;"><span id="touki1-value">0</span>/96</span><br>
            2P: <button id="touki2-charge" style="background: #400;">押して溜める</button>
            <button id="touki2-reset">リセット</button>
            <button id="touki2-set50">50%</button>
            <button id="touki2-set100">100%</button>
            <span style="margin-left: 5px;"><span id="touki2-value">0</span>/96</span><br>
            <strong style="color: #ff0;">1P色:</strong>
            <button id="touki1-color-red">赤</button>
            <button id="touki1-color-cyan">水色</button>
            <button id="touki1-color-purple">紫</button>
            　<strong style="color: #ff0;">2P色:</strong>
            <button id="touki2-color-red">赤</button>
            <button id="touki2-color-cyan">水色</button>
            <button id="touki2-color-purple">紫</button>
        </div>

        <!-- バランス調整（下部中） -->
        <div style="margin-bottom: 8px; padding: 4px; border: 1px solid #444;">
            <strong style="color: #ff0;">バランス:</strong><br>
            1P: <input type="number" id="balance1-input" min="0" max="255" value="0" style="width: 50px; background: #222; color: #fff; border: 1px solid #666;">
            <button id="balance1-set">設定</button>
            <button id="balance1-0">0%</button>
            <button id="balance1-50">50%</button>
            <button id="balance1-100">100%</button>
            <span style="margin-left: 5px;">現在: <span id="balance1-value">0</span></span><br>
            2P: <input type="number" id="balance2-input" min="0" max="255" value="0" style="width: 50px; background: #222; color: #fff; border: 1px solid #666;">
            <button id="balance2-set">設定</button>
            <button id="balance2-0">0%</button>
            <button id="balance2-50">50%</button>
            <button id="balance2-100">100%</button>
            <span style="margin-left: 5px;">現在: <span id="balance2-value">0</span></span><br>
            <strong style="color: #ff0;">入力ランプ:</strong>
            1P: <button id="lamp1-blue">青</button><button id="lamp1-yellow">黄</button><button id="lamp1-red">赤</button>
            　2P: <button id="lamp2-blue">青</button><button id="lamp2-yellow">黄</button><button id="lamp2-red">赤</button>
        </div>

        <!-- アイテム・霊気（下部下左右） -->
        <div style="margin-bottom: 8px; padding: 4px; border: 1px solid #444;">
            <strong style="color: #ff0;">アイテム/霊気:</strong><br>
            1P アイテム: 
            <button id="item1-none">なし</button>
            <button id="item1-ai-small">愛小</button>
            <button id="item1-ai-large">愛大</button>
            <button id="item1-ki-small">気小</button>
            <button id="item1-ki-large">気大</button>
            <button id="item1-rei-small">霊小</button>
            <button id="item1-rei-large">霊大</button><br>
            1P 霊気: <input type="number" id="reiki1-input" min="0" max="25" value="20" style="width: 40px; background: #222; color: #fff; border: 1px solid #666;">
            <button id="reiki1-set">設定</button>
            <button id="reiki1-0">0</button>
            <button id="reiki1-20">20</button>
            <button id="reiki1-25">25</button>
            <span style="margin-left: 5px;">現在: <span id="reiki1-value">20</span></span><br>
            2P アイテム: 
            <button id="item2-none">なし</button>
            <button id="item2-ai-small">愛小</button>
            <button id="item2-ai-large">愛大</button>
            <button id="item2-ki-small">気小</button>
            <button id="item2-ki-large">気大</button>
            <button id="item2-rei-small">霊小</button>
            <button id="item2-rei-large">霊大</button><br>
            2P 霊気: <input type="number" id="reiki2-input" min="0" max="25" value="20" style="width: 40px; background: #222; color: #fff; border: 1px solid #666;">
            <button id="reiki2-set">設定</button>
            <button id="reiki2-0">0</button>
            <button id="reiki2-20">20</button>
            <button id="reiki2-25">25</button>
            <span style="margin-left: 5px;">現在: <span id="reiki2-value">20</span></span><br>
            <strong style="color: #ff0;">ボタン:</strong>
            1P: <button id="btn1-all">全ON</button><button id="btn1-none">全OFF</button>
            <button id="btn1-toggle-a">A</button><button id="btn1-toggle-b">B</button>
            <button id="btn1-toggle-x">X</button><button id="btn1-toggle-y">Y</button><br>
            　　2P: <button id="btn2-all">全ON</button><button id="btn2-none">全OFF</button>
            <button id="btn2-toggle-a">A</button><button id="btn2-toggle-b">B</button>
            <button id="btn2-toggle-x">X</button><button id="btn2-toggle-y">Y</button>
        </div>

        <!-- 霊界水晶玉（下部中央） -->
        <div style="margin-bottom: 8px; padding: 4px; border: 1px solid #444;">
            <strong style="color: #ff0;">水晶玉:</strong><br>
            アイテム: 
            <button id="crystal-item-none">なし</button>
            <button id="crystal-item-ai-small">愛小</button>
            <button id="crystal-item-ai-large">愛大</button>
            <button id="crystal-item-ki-small">気小</button>
            <button id="crystal-item-ki-large">気大</button>
            <button id="crystal-item-rei-small">霊小</button>
            <button id="crystal-item-rei-large">霊大</button><br>
            霊気: 
            <button id="crystal-reiki-2">2個</button>
            <button id="crystal-reiki-3">3個</button>
            <button id="crystal-reiki-4">4個</button>
            <button id="crystal-reiki-5">5個</button>
            <button id="crystal-reiki-6">6個</button>
            <button id="crystal-clear">クリア</button>
            <span style="margin-left: 10px;">現在: <span id="crystal-value">●●●</span></span>
        </div>

        <!-- パネル表示/非表示 -->
        <div style="text-align: center; margin-top: 8px;">
            <button onclick="document.getElementById('debug-control-panel').style.display='none'">パネルを隠す</button>
            <span style="margin-left: 10px; color: #888;">（Ctrl+Dで再表示）</span>
        </div>
    </div>
    </div>

    <script>
        // ========================================
        // ========================================
        // 画面スケール機能
        // ========================================
        
        // 現在のスケール値を保持
        let currentScale = 1.0;
        
        /**
         * 画面スケールを変更する関数
         * @param {number} scale - 設定したいスケール値（0.5〜3.0）
         */
        function setGameScale(scale) {
            const container = document.getElementById('game-screen-container');
            if (container) {
                // スケールを適用
                container.style.transform = `scale(${scale})`;
                
                // 現在のスケール値を更新
                currentScale = scale;
                
                // 表示を更新
                const scaleDisplay = document.getElementById('current-scale');
                if (scaleDisplay) {
                    scaleDisplay.textContent = scale.toFixed(1);
                }
                
                // ボタンのハイライトを更新
                updateScaleButtonHighlight(scale);
            }
        }
        
        /**
         * スケールボタンのハイライトを更新
         * @param {number} scale - 現在のスケール値
         */
        function updateScaleButtonHighlight(scale) {
            // すべてのスケールボタンのハイライトをリセット
            document.querySelectorAll('[id^="scale-"]').forEach(btn => {
                btn.style.background = '#400';
            });
            
            // アクティブなボタンをハイライト
            const activeBtn = document.getElementById(`scale-${scale}x`);
            if (activeBtn) {
                activeBtn.style.background = '#060';
            }
        }
        
        // ========================================
        // 闘気メーター関連のコード（まとめ）
        // ========================================
        
        // 闘気メーターの状態管理
        // Touki values: 0-96 (97 levels, matches game specs)
        let touki1 = 0;
        let touki2 = 0;
        let isTouki1Charging = false;  // 1P充電中フラグ
        let isTouki2Charging = false;  // 2P充電中フラグ
        let toukiAnimationId = null;   // アニメーションID
        
        // 闘気メーターの内部幅を動的に取得する関数
        function getToukiMeterWidth(playerId) {
            const meterElement = document.querySelector(`.touki-meter.p${playerId}`);
            if (meterElement) {
                // getComputedStyleで実際の幅を取得
                const computedStyle = window.getComputedStyle(meterElement);
                const width = parseFloat(computedStyle.width);
                const borderLeft = parseFloat(computedStyle.borderLeftWidth);
                const borderRight = parseFloat(computedStyle.borderRightWidth);
                // ボーダーを除いた内部幅を返す
                return width - borderLeft - borderRight;
            }
            // フォールバック値
            return 176;
        }
        
        const TOUKI_CHARGE_SPEED = 0.96; // 充電速度 (96 frames to MAX)

        // 闘気メーターの値を更新する関数
        function updateToukiDisplay() {
            const touki1Element = document.getElementById('touki1');
            const touki2Element = document.getElementById('touki2');

            // 実際の枠の幅を動的に取得
            const meter1Width = getToukiMeterWidth(1);
            const meter2Width = getToukiMeterWidth(2);

            // 幅を更新（ピクセル値で設定）
            // touki: 0-96 → convert to percentage for display
            const width1 = (touki1 / 96 * 100 / 100) * meter1Width;
            const width2 = (touki2 / 96 * 100 / 100) * meter2Width;

            touki1Element.style.width = width1 + 'px';
            touki2Element.style.width = width2 + 'px';

            // デバッグパネルの値表示を更新 (show raw value)
            document.getElementById('touki1-value').textContent = Math.round(touki1);
            document.getElementById('touki2-value').textContent = Math.round(touki2);
        }

        // 闘気メーターのアニメーション処理
        function animateTouki() {
            // 1Pの処理（押している間だけ増加）
            if (isTouki1Charging && touki1 < 96) {
                touki1 = Math.min(96, touki1 + TOUKI_CHARGE_SPEED);
            }

            // 2Pの処理（押している間だけ増加）
            if (isTouki2Charging && touki2 < 96) {
                touki2 = Math.min(96, touki2 + TOUKI_CHARGE_SPEED);
            }

            updateToukiDisplay();
            toukiAnimationId = requestAnimationFrame(animateTouki);
        }
        
        // 1P闘気メーター制御関数
        function startChargeTouki1() {
            isTouki1Charging = true;
            document.getElementById('touki1-charge').style.background = '#800';
        }
        
        function stopChargeTouki1() {
            isTouki1Charging = false;
            document.getElementById('touki1-charge').style.background = '#400';
        }
        
        function resetTouki1() {
            touki1 = 0;
            updateToukiDisplay();
        }
        
        function setTouki1(value) {
            touki1 = value;
            updateToukiDisplay();
        }
        
        // 2P闘気メーター制御関数
        function startChargeTouki2() {
            isTouki2Charging = true;
            document.getElementById('touki2-charge').style.background = '#800';
        }
        
        function stopChargeTouki2() {
            isTouki2Charging = false;
            document.getElementById('touki2-charge').style.background = '#400';
        }
        
        function resetTouki2() {
            touki2 = 0;
            updateToukiDisplay();
        }
        
        function setTouki2(value) {
            touki2 = value;
            updateToukiDisplay();
        }
        
        // 闘気メーターのアニメーション開始
        animateTouki();
        
        // 1P闘気メーターの色を変更する関数
        function setTouki1Color(color) {
            let colorCode = '#ff0000';  // デフォルトは赤
            
            switch(color) {
                case 'red':
                    colorCode = '#ff0000';
                    break;
                case 'cyan':
                    colorCode = '#00ffff';
                    break;
                case 'purple':
                    colorCode = '#9900ff';
                    break;
            }
            
            document.getElementById('touki1').style.background = colorCode;
        }
        
        // 2P闘気メーターの色を変更する関数
        function setTouki2Color(color) {
            let colorCode = '#ff0000';  // デフォルトは赤
            
            switch(color) {
                case 'red':
                    colorCode = '#ff0000';
                    break;
                case 'cyan':
                    colorCode = '#00ffff';
                    break;
                case 'purple':
                    colorCode = '#9900ff';
                    break;
            }
            
            document.getElementById('touki2').style.background = colorCode;
        }
        
        // 闘気ボタンのイベントリスナー設定
        document.addEventListener('DOMContentLoaded', () => {
            // ========================================
            // 画面スケールボタンのイベントリスナー
            // ========================================
            
            // 各スケールボタンにイベントを設定
            const scaleButtons = [
                { id: 'scale-0.5x', value: 0.5 },
                { id: 'scale-1x', value: 1.0 },
                { id: 'scale-1.5x', value: 1.5 },
                { id: 'scale-2x', value: 2.0 },
                { id: 'scale-3x', value: 3.0 }
            ];
            
            scaleButtons.forEach(button => {
                const btn = document.getElementById(button.id);
                if (btn) {
                    btn.addEventListener('click', () => {
                        setGameScale(button.value);
                    });
                }
            });
            
            // ========================================
            // 闘気メーターのイベントリスナー
            // ========================================
            // 1P闘気コントロール
            const touki1ChargeBtn = document.getElementById('touki1-charge');
            touki1ChargeBtn.addEventListener('mousedown', startChargeTouki1);
            touki1ChargeBtn.addEventListener('mouseup', stopChargeTouki1);
            touki1ChargeBtn.addEventListener('mouseleave', stopChargeTouki1);
            touki1ChargeBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startChargeTouki1();
            });
            touki1ChargeBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                stopChargeTouki1();
            });
            
            document.getElementById('touki1-reset').addEventListener('click', resetTouki1);
            document.getElementById('touki1-set50').addEventListener('click', () => setTouki1(48)); // 50% of 96
            document.getElementById('touki1-set100').addEventListener('click', () => setTouki1(96)); // MAX
            
            // 2P闘気コントロール
            const touki2ChargeBtn = document.getElementById('touki2-charge');
            touki2ChargeBtn.addEventListener('mousedown', startChargeTouki2);
            touki2ChargeBtn.addEventListener('mouseup', stopChargeTouki2);
            touki2ChargeBtn.addEventListener('mouseleave', stopChargeTouki2);
            touki2ChargeBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startChargeTouki2();
            });
            touki2ChargeBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                stopChargeTouki2();
            });
            
            document.getElementById('touki2-reset').addEventListener('click', resetTouki2);
            document.getElementById('touki2-set50').addEventListener('click', () => setTouki2(48)); // 50% of 96
            document.getElementById('touki2-set100').addEventListener('click', () => setTouki2(96)); // MAX
            
            // 1P闘気メーター色変更
            document.getElementById('touki1-color-red').addEventListener('click', () => {
                document.getElementById('touki1').style.background = '#ff0000';
            });
            
            document.getElementById('touki1-color-cyan').addEventListener('click', () => {
                document.getElementById('touki1').style.background = '#00ffff';
            });
            
            document.getElementById('touki1-color-purple').addEventListener('click', () => {
                document.getElementById('touki1').style.background = '#9900ff';
            });
            
            // 2P闘気メーター色変更
            document.getElementById('touki2-color-red').addEventListener('click', () => {
                document.getElementById('touki2').style.background = '#ff0000';
            });
            
            document.getElementById('touki2-color-cyan').addEventListener('click', () => {
                document.getElementById('touki2').style.background = '#00ffff';
            });
            
            document.getElementById('touki2-color-purple').addEventListener('click', () => {
                document.getElementById('touki2').style.background = '#9900ff';
            });
        });
        
        // ========================================
        // HPメーター関連のコード
        // ========================================
        
        // HP values: 0-96 (matches game specs)
        let hp1Current = 96;
        let hp2Current = 96;
        let hp1Target = 96;
        let hp2Target = 96;

        // HPメーターの更新関数
        function updateHPDisplay() {
            // 1P HP更新
            const hp1Yellow = document.querySelector('.hp-bar.p1 .hp-bar-yellow');
            const hp1Red = document.querySelector('.hp-bar.p1 .hp-bar-red');

            // HP: 0-96 → convert to percentage
            const hp1Percent = (hp1Current / 96) * 100;

            if (hp1Percent <= 50) {
                // 黄色バーのみ（0-50%）
                hp1Yellow.style.width = (hp1Percent * 2) + '%';  // 0-50を0-100%に変換
                hp1Red.style.width = '0%';
            } else {
                // 赤バーと黄色バー（51-100%）
                hp1Yellow.style.width = '100%';
                hp1Red.style.width = ((hp1Percent - 50) * 2) + '%';  // 51-100を0-100%に変換
            }

            // 2P HP更新
            const hp2Yellow = document.querySelector('.hp-bar.p2 .hp-bar-yellow');
            const hp2Red = document.querySelector('.hp-bar.p2 .hp-bar-red');

            const hp2Percent = (hp2Current / 96) * 100;

            if (hp2Percent <= 50) {
                // 黄色バーのみ（0-50%）
                hp2Yellow.style.width = (hp2Percent * 2) + '%';
                hp2Red.style.width = '0%';
            } else {
                // 赤バーと黄色バー（51-100%）
                hp2Yellow.style.width = '100%';
                hp2Red.style.width = ((hp2Percent - 50) * 2) + '%';
            }

            // 表示値更新 (show raw value)
            document.getElementById('hp1-value').textContent = Math.round(hp1Current);
            document.getElementById('hp2-value').textContent = Math.round(hp2Current);
        }
        
        // HPアニメーション処理
        function animateHP() {
            // 1P HP徐々に変更
            if (Math.abs(hp1Current - hp1Target) > 0.5) {
                const diff = hp1Target - hp1Current;
                hp1Current += diff * 0.1;  // 10%ずつ目標値に近づける
            } else {
                hp1Current = hp1Target;
            }
            
            // 2P HP徐々に変更
            if (Math.abs(hp2Current - hp2Target) > 0.5) {
                const diff = hp2Target - hp2Current;
                hp2Current += diff * 0.1;  // 10%ずつ目標値に近づける
            } else {
                hp2Current = hp2Target;
            }
            
            updateHPDisplay();
            requestAnimationFrame(animateHP);
        }
        
        // HP設定関数
        function setHP1(value) {
            value = Math.max(0, Math.min(96, value));  // 0-96の範囲に制限
            hp1Target = value;
            document.getElementById('hp1-input').value = value;
        }

        function setHP2(value) {
            value = Math.max(0, Math.min(96, value));  // 0-96の範囲に制限
            hp2Target = value;
            document.getElementById('hp2-input').value = value;
        }
        
        // HPアニメーション開始
        animateHP();
        
        // HPボタンのイベントリスナー設定
        document.addEventListener('DOMContentLoaded', () => {
            // 1P HPコントロール
            document.getElementById('hp1-set').addEventListener('click', () => {
                const value = parseFloat(document.getElementById('hp1-input').value);
                setHP1(value);
            });
            document.getElementById('hp1-0').addEventListener('click', () => setHP1(0)); // Defeated
            document.getElementById('hp1-50').addEventListener('click', () => setHP1(48)); // Half HP
            document.getElementById('hp1-100').addEventListener('click', () => setHP1(96)); // Full HP
            
            // 2P HPコントロール
            document.getElementById('hp2-set').addEventListener('click', () => {
                const value = parseFloat(document.getElementById('hp2-input').value);
                setHP2(value);
            });
            document.getElementById('hp2-0').addEventListener('click', () => setHP2(0)); // Defeated
            document.getElementById('hp2-50').addEventListener('click', () => setHP2(48)); // Half HP
            document.getElementById('hp2-100').addEventListener('click', () => setHP2(96)); // Full HP
            
            // Enterキーでも設定できるように
            document.getElementById('hp1-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    setHP1(parseFloat(e.target.value));
                }
            });
            document.getElementById('hp2-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    setHP2(parseFloat(e.target.value));
                }
            });
        });
        
        // ========================================
        // バランスメーター関連のコード
        // ========================================
        
        // Balance values: 0-255 (balance DAMAGE, 0=full bar, 255=knocked down)
        // Inverted from display: bar shows remaining balance
        let balance1Current = 0;
        let balance2Current = 0;
        let balance1Target = 0;
        let balance2Target = 0;

        // バランスメーターの更新関数
        function updateBalanceDisplay() {
            // 1P バランス更新
            // Convert balance damage (0-255) to remaining percentage (0-100%)
            const balance1Percent = ((256 - balance1Current) / 256) * 100;
            const balance1Fill = document.querySelector('.balance-meter.p1 .balance-meter-fill');
            balance1Fill.style.width = balance1Percent + '%';

            // 2P バランス更新
            const balance2Percent = ((256 - balance2Current) / 256) * 100;
            const balance2Fill = document.querySelector('.balance-meter.p2 .balance-meter-fill');
            balance2Fill.style.width = balance2Percent + '%';

            // 表示値更新 (show raw damage value)
            document.getElementById('balance1-value').textContent = Math.round(balance1Current);
            document.getElementById('balance2-value').textContent = Math.round(balance2Current);
        }
        
        // バランスアニメーション処理
        // ========================================
        // 重要：CSSトランジションとJSアニメーションを意図的に併用
        // これにより「途中で詰まって最後にきゅっと伸びる」独特の動きを実現
        // 
        // 動作の仕組み：
        // 1. JS: 差分の10%ずつ近づける（指数関数的減衰）
        // 2. CSS: width変更時に0.3秒のeaseトランジション
        // 3. 結果: 序盤は速く、中盤で詰まり、最後にきゅっと伸びる
        // 
        // この動きは格ゲーらしい演出として採用（バグじゃなくて仕様です！）
        // 変更する場合は両方の相互作用を考慮すること
        // ========================================
        function animateBalance() {
            // 1P バランス徐々に変更
            if (Math.abs(balance1Current - balance1Target) > 0.5) {
                const diff = balance1Target - balance1Current;
                balance1Current += diff * 0.1;  // 10%ずつ目標値に近づける（指数関数的減衰）
            } else {
                balance1Current = balance1Target;  // 最後は即座に設定（きゅっと止まる）
            }
            
            // 2P バランス徐々に変更
            if (Math.abs(balance2Current - balance2Target) > 0.5) {
                const diff = balance2Target - balance2Current;
                balance2Current += diff * 0.1;  // 10%ずつ目標値に近づける（指数関数的減衰）
            } else {
                balance2Current = balance2Target;  // 最後は即座に設定（きゅっと止まる）
            }
            
            updateBalanceDisplay();
            requestAnimationFrame(animateBalance);
        }
        
        // バランス設定関数
        function setBalance1(value) {
            value = Math.max(0, Math.min(255, value));  // 0-255の範囲に制限
            balance1Target = value;
            document.getElementById('balance1-input').value = value;
        }

        function setBalance2(value) {
            value = Math.max(0, Math.min(255, value));  // 0-255の範囲に制限
            balance2Target = value;
            document.getElementById('balance2-input').value = value;
        }
        
        // バランスアニメーション開始
        animateBalance();
        
        // バランスボタンのイベントリスナー設定
        document.addEventListener('DOMContentLoaded', () => {
            // 1P バランスコントロール
            document.getElementById('balance1-set').addEventListener('click', () => {
                const value = parseFloat(document.getElementById('balance1-input').value);
                setBalance1(value);
            });
            document.getElementById('balance1-0').addEventListener('click', () => setBalance1(0)); // No damage (full bar)
            document.getElementById('balance1-50').addEventListener('click', () => setBalance1(128)); // Half damage
            document.getElementById('balance1-100').addEventListener('click', () => setBalance1(255)); // Knocked down
            
            // 2P バランスコントロール
            document.getElementById('balance2-set').addEventListener('click', () => {
                const value = parseFloat(document.getElementById('balance2-input').value);
                setBalance2(value);
            });
            document.getElementById('balance2-0').addEventListener('click', () => setBalance2(0)); // No damage (full bar)
            document.getElementById('balance2-50').addEventListener('click', () => setBalance2(128)); // Half damage
            document.getElementById('balance2-100').addEventListener('click', () => setBalance2(255)); // Knocked down
            
            // Enterキーでも設定できるように
            document.getElementById('balance1-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    setBalance1(parseFloat(e.target.value));
                }
            });
            document.getElementById('balance2-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    setBalance2(parseFloat(e.target.value));
                }
            });
        });
        
        // ========================================
        // アイテム・霊気ゲージ関連のコード
        // ========================================
        
        // アイテムの状態管理
        let item1Current = '';
        let item2Current = '';
        
        // 霊気の状態管理（0-25）
        let reiki1Current = 20;
        let reiki2Current = 20;
        let reiki1Target = 20;
        let reiki2Target = 20;
        let reiki1Animating = false;
        let reiki2Animating = false;
        
        // アイテム表示の更新関数
        function updateItemDisplay() {
            // 1P アイテム更新
            const item1Slot = document.querySelector('.player-info.p1 .item-slot');
            if (item1Current === '') {
                item1Slot.textContent = '---';
                item1Slot.classList.add('empty');
            } else {
                item1Slot.textContent = item1Current;
                item1Slot.classList.remove('empty');
            }
            
            // 2P アイテム更新
            const item2Slot = document.querySelector('.player-info.p2 .item-slot');
            if (item2Current === '') {
                item2Slot.textContent = '---';
                item2Slot.classList.add('empty');
            } else {
                item2Slot.textContent = item2Current;
                item2Slot.classList.remove('empty');
            }
        }
        
        // 霊気ゲージ表示の即座更新関数（アニメーションなし）
        function updateReikiDisplayImmediate(player) {
            if (player === 1) {
                const reiki1Cells = document.querySelectorAll('.player-info.p1 .reiki-cell');
                const reiki1Label = document.querySelector('.player-info.p1 .reiki-label');
                reiki1Cells.forEach((cell, index) => {
                    if (index < reiki1Current) {
                        cell.classList.add('filled');
                    } else {
                        cell.classList.remove('filled');
                    }
                });
                reiki1Label.textContent = `霊気ゲージ (${reiki1Current}/25)`;
                document.getElementById('reiki1-value').textContent = reiki1Current;
            } else {
                const reiki2Cells = document.querySelectorAll('.player-info.p2 .reiki-cell');
                const reiki2Label = document.querySelector('.player-info.p2 .reiki-label');
                reiki2Cells.forEach((cell, index) => {
                    if (index < reiki2Current) {
                        cell.classList.add('filled');
                    } else {
                        cell.classList.remove('filled');
                    }
                });
                reiki2Label.textContent = `霊気ゲージ (${reiki2Current}/25)`;
                document.getElementById('reiki2-value').textContent = reiki2Current;
            }
        }
        
        // 霊気ゲージのアニメーション付き更新
        async function animateReiki(player) {
            if (player === 1) {
                if (reiki1Animating) return;
                reiki1Animating = true;
                
                const cells = document.querySelectorAll('.player-info.p1 .reiki-cell');
                const label = document.querySelector('.player-info.p1 .reiki-label');
                
                while (reiki1Current !== reiki1Target) {
                    if (reiki1Current < reiki1Target) {
                        // 増加
                        const cellIndex = reiki1Current;
                        if (cellIndex < 25) {
                            cells[cellIndex].classList.add('blinking');
                            await new Promise(resolve => setTimeout(resolve, 150));
                            cells[cellIndex].classList.add('filled');
                            await new Promise(resolve => setTimeout(resolve, 150));
                            cells[cellIndex].classList.remove('blinking');
                            reiki1Current++;
                        }
                    } else {
                        // 減少
                        const cellIndex = reiki1Current - 1;
                        if (cellIndex >= 0) {
                            cells[cellIndex].classList.add('blinking');
                            await new Promise(resolve => setTimeout(resolve, 150));
                            cells[cellIndex].classList.remove('filled');
                            await new Promise(resolve => setTimeout(resolve, 150));
                            cells[cellIndex].classList.remove('blinking');
                            reiki1Current--;
                        }
                    }
                    label.textContent = `霊気ゲージ (${reiki1Current}/25)`;
                    document.getElementById('reiki1-value').textContent = reiki1Current;
                }
                reiki1Animating = false;
            } else {
                if (reiki2Animating) return;
                reiki2Animating = true;
                
                const cells = document.querySelectorAll('.player-info.p2 .reiki-cell');
                const label = document.querySelector('.player-info.p2 .reiki-label');
                
                while (reiki2Current !== reiki2Target) {
                    if (reiki2Current < reiki2Target) {
                        // 増加
                        const cellIndex = reiki2Current;
                        if (cellIndex < 25) {
                            cells[cellIndex].classList.add('blinking');
                            await new Promise(resolve => setTimeout(resolve, 150));
                            cells[cellIndex].classList.add('filled');
                            await new Promise(resolve => setTimeout(resolve, 150));
                            cells[cellIndex].classList.remove('blinking');
                            reiki2Current++;
                        }
                    } else {
                        // 減少
                        const cellIndex = reiki2Current - 1;
                        if (cellIndex >= 0) {
                            cells[cellIndex].classList.add('blinking');
                            await new Promise(resolve => setTimeout(resolve, 150));
                            cells[cellIndex].classList.remove('filled');
                            await new Promise(resolve => setTimeout(resolve, 150));
                            cells[cellIndex].classList.remove('blinking');
                            reiki2Current--;
                        }
                    }
                    label.textContent = `霊気ゲージ (${reiki2Current}/25)`;
                    document.getElementById('reiki2-value').textContent = reiki2Current;
                }
                reiki2Animating = false;
            }
        }
        
        // アイテム設定関数
        function setItem1(itemName) {
            item1Current = itemName;
            updateItemDisplay();
        }
        
        function setItem2(itemName) {
            item2Current = itemName;
            updateItemDisplay();
        }
        
        // 霊気設定関数
        function setReiki1(value) {
            value = Math.max(0, Math.min(25, value));  // 0-25の範囲に制限
            reiki1Target = value;
            document.getElementById('reiki1-input').value = value;
            animateReiki(1);
        }
        
        function setReiki2(value) {
            value = Math.max(0, Math.min(25, value));  // 0-25の範囲に制限
            reiki2Target = value;
            document.getElementById('reiki2-input').value = value;
            animateReiki(2);
        }
        
        // 初期表示更新
        updateItemDisplay();
        updateReikiDisplayImmediate(1);
        updateReikiDisplayImmediate(2);
        
        // アイテム・霊気ボタンのイベントリスナー設定
        document.addEventListener('DOMContentLoaded', () => {
            // 1P アイテムコントロール
            document.getElementById('item1-none').addEventListener('click', () => setItem1(''));
            document.getElementById('item1-ai-small').addEventListener('click', () => setItem1('愛(小)'));
            document.getElementById('item1-ai-large').addEventListener('click', () => setItem1('愛(大)'));
            document.getElementById('item1-ki-small').addEventListener('click', () => setItem1('気(小)'));
            document.getElementById('item1-ki-large').addEventListener('click', () => setItem1('気(大)'));
            document.getElementById('item1-rei-small').addEventListener('click', () => setItem1('霊(小)'));
            document.getElementById('item1-rei-large').addEventListener('click', () => setItem1('霊(大)'));
            
            // 1P 霊気コントロール
            document.getElementById('reiki1-set').addEventListener('click', () => {
                const value = parseInt(document.getElementById('reiki1-input').value);
                setReiki1(value);
            });
            document.getElementById('reiki1-0').addEventListener('click', () => setReiki1(0));
            document.getElementById('reiki1-20').addEventListener('click', () => setReiki1(20));
            document.getElementById('reiki1-25').addEventListener('click', () => setReiki1(25));
            
            // 2P アイテムコントロール
            document.getElementById('item2-none').addEventListener('click', () => setItem2(''));
            document.getElementById('item2-ai-small').addEventListener('click', () => setItem2('愛(小)'));
            document.getElementById('item2-ai-large').addEventListener('click', () => setItem2('愛(大)'));
            document.getElementById('item2-ki-small').addEventListener('click', () => setItem2('気(小)'));
            document.getElementById('item2-ki-large').addEventListener('click', () => setItem2('気(大)'));
            document.getElementById('item2-rei-small').addEventListener('click', () => setItem2('霊(小)'));
            document.getElementById('item2-rei-large').addEventListener('click', () => setItem2('霊(大)'));
            
            // 2P 霊気コントロール
            document.getElementById('reiki2-set').addEventListener('click', () => {
                const value = parseInt(document.getElementById('reiki2-input').value);
                setReiki2(value);
            });
            document.getElementById('reiki2-0').addEventListener('click', () => setReiki2(0));
            document.getElementById('reiki2-20').addEventListener('click', () => setReiki2(20));
            document.getElementById('reiki2-25').addEventListener('click', () => setReiki2(25));
            
            // Enterキーでも設定できるように
            document.getElementById('reiki1-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    setReiki1(parseInt(e.target.value));
                }
            });
            document.getElementById('reiki2-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    setReiki2(parseInt(e.target.value));
                }
            });
        });
        
        // ========================================
        // 霊界水晶玉関連のコード
        // ========================================
        
        // 水晶玉の状態管理
        let crystalType = 'reiki';  // 'reiki' or 'item'
        let crystalReikiCount = 3;   // 2-6の霊気個数
        let crystalItemType = '';    // アイテム種類
        
        // 水晶玉表示の更新関数
        function updateCrystalDisplay() {
            const crystalContent = document.querySelector('.crystal-content');
            const crystalValue = document.getElementById('crystal-value');
            
            if (crystalType === 'reiki') {
                // 霊気玉表示（●の数で表現）
                let dots = '';
                if (crystalReikiCount <= 3) {
                    // 3個以下は1行
                    for (let i = 0; i < crystalReikiCount; i++) {
                        dots += '●';
                    }
                } else {
                    // 4個以上は2行に分割
                    const firstRow = Math.ceil(crystalReikiCount / 2);
                    const secondRow = crystalReikiCount - firstRow;
                    
                    for (let i = 0; i < firstRow; i++) {
                        dots += '●';
                    }
                    dots += '<br>';
                    for (let i = 0; i < secondRow; i++) {
                        dots += '●';
                    }
                }
                crystalContent.innerHTML = dots;
                crystalContent.style.color = '#0ff';
                crystalContent.style.fontSize = '18px';  // 少し小さく
                crystalContent.style.lineHeight = '0.8';
                crystalValue.textContent = `霊気${crystalReikiCount}個`;
            } else if (crystalType === 'item') {
                // アイテム表示
                if (crystalItemType === '') {
                    crystalContent.innerHTML = '---';
                    crystalContent.style.color = '#666';
                    crystalValue.textContent = 'なし';
                } else {
                    // アイテムの種類に応じて色を変更
                    let itemColor = '#fff';
                    if (crystalItemType.includes('愛')) {
                        itemColor = '#ff69b4';  // ピンク
                    } else if (crystalItemType.includes('気')) {
                        itemColor = '#ffff00';  // 黄色
                    } else if (crystalItemType.includes('霊')) {
                        itemColor = '#00ffff';  // シアン
                    }
                    
                    // アイテム名を分解（例：愛(小) → 愛 と (小)）
                    const baseName = crystalItemType.substring(0, 1);  // 愛、気、霊
                    const sizePart = crystalItemType.substring(1);     // (小) or (大)
                    const sizeText = sizePart.replace('(', '').replace(')', '');  // 小 or 大
                    
                    // サイズに応じてフォントサイズを変更
                    let sizeStyle = '';
                    if (sizeText === '大') {
                        sizeStyle = 'font-size: 14px;';
                    } else if (sizeText === '小') {
                        sizeStyle = 'font-size: 10px;';
                    }
                    
                    // HTMLとして表示
                    crystalContent.innerHTML = `<span style="color: ${itemColor}; font-size: 18px;">${baseName}</span><span style="color: ${itemColor}; ${sizeStyle}">(${sizeText})</span>`;
                    crystalContent.style.fontSize = '18px';
                    crystalContent.style.lineHeight = '1';
                    crystalValue.textContent = crystalItemType;
                }
            } else {
                // クリア状態
                crystalContent.innerHTML = '';
                crystalValue.textContent = 'クリア';
            }
        }
        
        // 水晶玉設定関数
        function setCrystalReiki(count) {
            crystalType = 'reiki';
            crystalReikiCount = count;
            updateCrystalDisplay();
        }
        
        function setCrystalItem(itemName) {
            crystalType = 'item';
            crystalItemType = itemName;
            updateCrystalDisplay();
        }
        
        function clearCrystal() {
            crystalType = '';
            crystalItemType = '';
            crystalReikiCount = 0;
            updateCrystalDisplay();
        }
        
        // 初期表示更新
        updateCrystalDisplay();
        
        // 水晶玉ボタンのイベントリスナー設定
        document.addEventListener('DOMContentLoaded', () => {
            // アイテム設定
            document.getElementById('crystal-item-none').addEventListener('click', () => setCrystalItem(''));
            document.getElementById('crystal-item-ai-small').addEventListener('click', () => setCrystalItem('愛(小)'));
            document.getElementById('crystal-item-ai-large').addEventListener('click', () => setCrystalItem('愛(大)'));
            document.getElementById('crystal-item-ki-small').addEventListener('click', () => setCrystalItem('気(小)'));
            document.getElementById('crystal-item-ki-large').addEventListener('click', () => setCrystalItem('気(大)'));
            document.getElementById('crystal-item-rei-small').addEventListener('click', () => setCrystalItem('霊(小)'));
            document.getElementById('crystal-item-rei-large').addEventListener('click', () => setCrystalItem('霊(大)'));
            
            // 霊気個数設定
            document.getElementById('crystal-reiki-2').addEventListener('click', () => setCrystalReiki(2));
            document.getElementById('crystal-reiki-3').addEventListener('click', () => setCrystalReiki(3));
            document.getElementById('crystal-reiki-4').addEventListener('click', () => setCrystalReiki(4));
            document.getElementById('crystal-reiki-5').addEventListener('click', () => setCrystalReiki(5));
            document.getElementById('crystal-reiki-6').addEventListener('click', () => setCrystalReiki(6));
            
            // クリア
            document.getElementById('crystal-clear').addEventListener('click', clearCrystal);
        });
        
        // ========================================
        // 入力受付ランプ関連のコード
        // ========================================
        
        // 入力受付ランプの色を設定する関数
        function setInputLamp(player, color) {
            const lampId = player === 1 ? 'input-lamp-1p' : 'input-lamp-2p';
            const lamp = document.getElementById(lampId);
            
            if (!lamp) return;
            
            let bgColor = '#0080ff';  // デフォルトは青
            let shadowColor = '#0080ff';
            
            switch(color) {
                case 'blue':
                    bgColor = '#0080ff';
                    shadowColor = '#0080ff';
                    break;
                case 'yellow':
                    bgColor = '#ffff00';
                    shadowColor = '#ffff00';
                    break;
                case 'red':
                    bgColor = '#ff0000';
                    shadowColor = '#ff0000';
                    break;
            }
            
            lamp.style.background = bgColor;
            lamp.style.boxShadow = `0 0 10px ${shadowColor}`;
        }
        
        // 入力受付ランプのイベントリスナー設定
        document.addEventListener('DOMContentLoaded', () => {
            // 1P入力ランプ
            document.getElementById('lamp1-blue').addEventListener('click', () => setInputLamp(1, 'blue'));
            document.getElementById('lamp1-yellow').addEventListener('click', () => setInputLamp(1, 'yellow'));
            document.getElementById('lamp1-red').addEventListener('click', () => setInputLamp(1, 'red'));
            
            // 2P入力ランプ
            document.getElementById('lamp2-blue').addEventListener('click', () => setInputLamp(2, 'blue'));
            document.getElementById('lamp2-yellow').addEventListener('click', () => setInputLamp(2, 'yellow'));
            document.getElementById('lamp2-red').addEventListener('click', () => setInputLamp(2, 'red'));
        });
        
        // ========================================
        // ボタンランプ関連のコード
        // ========================================
        
        // ボタンの状態を設定する関数
        function setButtonState(player, button, enabled) {
            const btnId = `btn-${player}p-${button}`;
            const btn = document.getElementById(btnId);
            
            if (!btn) return;
            
            let color = '#000';  // デフォルトは黒（無効）
            
            if (enabled) {
                switch(button) {
                    case 'y':
                        color = '#0080ff';  // 青
                        break;
                    case 'x':
                        color = '#00ff00';  // 緑
                        break;
                    case 'b':
                        color = '#ffff00';  // 黄
                        break;
                    case 'a':
                        color = '#ff0000';  // 赤
                        break;
                }
            }
            
            btn.style.background = color;
        }
        
        // 全ボタンの状態を設定
        function setAllButtons(player, enabled) {
            ['a', 'b', 'x', 'y'].forEach(button => {
                setButtonState(player, button, enabled);
            });
        }
        
        // ボタン制御のイベントリスナー設定
        document.addEventListener('DOMContentLoaded', () => {
            // 1Pボタン制御
            document.getElementById('btn1-all').addEventListener('click', () => setAllButtons(1, true));
            document.getElementById('btn1-none').addEventListener('click', () => setAllButtons(1, false));
            document.getElementById('btn1-toggle-a').addEventListener('click', () => {
                const btn = document.getElementById('btn-1p-a');
                const isOn = btn.style.background !== 'rgb(0, 0, 0)';
                setButtonState(1, 'a', !isOn);
            });
            document.getElementById('btn1-toggle-b').addEventListener('click', () => {
                const btn = document.getElementById('btn-1p-b');
                const isOn = btn.style.background !== 'rgb(0, 0, 0)';
                setButtonState(1, 'b', !isOn);
            });
            document.getElementById('btn1-toggle-x').addEventListener('click', () => {
                const btn = document.getElementById('btn-1p-x');
                const isOn = btn.style.background !== 'rgb(0, 0, 0)';
                setButtonState(1, 'x', !isOn);
            });
            document.getElementById('btn1-toggle-y').addEventListener('click', () => {
                const btn = document.getElementById('btn-1p-y');
                const isOn = btn.style.background !== 'rgb(0, 0, 0)';
                setButtonState(1, 'y', !isOn);
            });
            
            // 2Pボタン制御
            document.getElementById('btn2-all').addEventListener('click', () => setAllButtons(2, true));
            document.getElementById('btn2-none').addEventListener('click', () => setAllButtons(2, false));
            document.getElementById('btn2-toggle-a').addEventListener('click', () => {
                const btn = document.getElementById('btn-2p-a');
                const isOn = btn.style.background !== 'rgb(0, 0, 0)';
                setButtonState(2, 'a', !isOn);
            });
            document.getElementById('btn2-toggle-b').addEventListener('click', () => {
                const btn = document.getElementById('btn-2p-b');
                const isOn = btn.style.background !== 'rgb(0, 0, 0)';
                setButtonState(2, 'b', !isOn);
            });
            document.getElementById('btn2-toggle-x').addEventListener('click', () => {
                const btn = document.getElementById('btn-2p-x');
                const isOn = btn.style.background !== 'rgb(0, 0, 0)';
                setButtonState(2, 'x', !isOn);
            });
            document.getElementById('btn2-toggle-y').addEventListener('click', () => {
                const btn = document.getElementById('btn-2p-y');
                const isOn = btn.style.background !== 'rgb(0, 0, 0)';
                setButtonState(2, 'y', !isOn);
            });
        });
        
        let battlefieldMode = 'split';  // 'split' or 'single'
        
        // 画面モードを切り替える関数
        function setBattlefieldMode(mode) {
            const characterArea = document.getElementById('character-area');
            
            if (mode === 'single') {
                // 統合モード（一枚絵）
                battlefieldMode = 'single';
                characterArea.className = 'character-area single-mode';
                characterArea.innerHTML = `
                    <div class="single-image">
                        統合画面（背景や一枚絵をここに表示）
                    </div>
                `;
            } else {
                // 分割モード（通常）
                battlefieldMode = 'split';
                characterArea.className = 'character-area split-mode';
                characterArea.innerHTML = `
                    <div class="character" id="character-1p">
                        １Ｐ
                    </div>
                    <div class="character" id="character-2p">
                        ２Ｐ
                    </div>
                `;
            }
        }
        
        // キャラクター点滅を制御する関数
        function setCharacterBlink(player) {
            // 分割モードの場合のみ動作
            if (battlefieldMode !== 'split') return;
            
            const char1p = document.getElementById('character-1p');
            const char2p = document.getElementById('character-2p');
            
            if (!char1p || !char2p) return;
            
            if (player === '1p') {
                // 1Pの点滅をトグル
                char1p.classList.toggle('active-player');
            } else if (player === '2p') {
                // 2Pの点滅をトグル
                char2p.classList.toggle('active-player');
            } else if (player === 'none') {
                // 両方の点滅を解除
                char1p.classList.remove('active-player');
                char2p.classList.remove('active-player');
            }
        }
        
        // 背景画像を設定する関数
        function setBackgroundImage(imageUrl) {
            setBattlefieldMode('single');
            const singleImage = document.querySelector('.single-image');
            if (singleImage) {
                singleImage.style.backgroundImage = `url(${imageUrl})`;
                singleImage.style.backgroundSize = 'cover';
                singleImage.style.backgroundPosition = 'center';
                singleImage.textContent = '';
            }
        }
        
        // メッセージを設定する関数
        function setMessage(text) {
            const messageBox = document.getElementById('message-box');
            if (messageBox) {
                messageBox.textContent = text;
            }
        }
        
        // 外部から使用可能な関数
        window.GameUI = window.GameUI || {};
        window.GameUI.setBattlefieldMode = setBattlefieldMode;
        window.GameUI.setBackgroundImage = setBackgroundImage;
        window.GameUI.setMessage = setMessage;
        window.GameUI.setCharacterBlink = setCharacterBlink;
        window.GameUI.setInputLamp = setInputLamp;
        window.GameUI.setScale = setGameScale;  // 画面スケール変更関数を追加
        
        // モード切替とメッセージのイベントリスナー
        document.addEventListener('DOMContentLoaded', () => {
            // モード切替ボタン
            document.getElementById('mode-split').addEventListener('click', () => {
                setBattlefieldMode('split');
            });
            
            document.getElementById('mode-single').addEventListener('click', () => {
                setBattlefieldMode('single');
            });
            
            document.getElementById('mode-bg-test').addEventListener('click', () => {
                setBattlefieldMode('single');
                const singleImage = document.querySelector('.single-image');
                if (singleImage) {
                    singleImage.style.background = 'linear-gradient(45deg, #ff6b6b, #4ecdc4)';
                    singleImage.textContent = 'テスト背景';
                }
            });
            
            // 点滅コントロール
            document.getElementById('blink-1p').addEventListener('click', () => {
                setCharacterBlink('1p');
            });
            
            document.getElementById('blink-2p').addEventListener('click', () => {
                setCharacterBlink('2p');
            });
            
            document.getElementById('blink-none').addEventListener('click', () => {
                setCharacterBlink('none');
            });
            
            // メッセージ設定
            document.getElementById('message-set').addEventListener('click', () => {
                const input = document.getElementById('message-input');
                setMessage(input.value);
            });
            
            document.getElementById('message-clear').addEventListener('click', () => {
                setMessage('');
                document.getElementById('message-input').value = '';
            });
            
            document.getElementById('message-sample1').addEventListener('click', () => {
                const msg = '飛影の邪王炎殺黒龍波！';
                setMessage(msg);
                document.getElementById('message-input').value = msg;
            });
            
            document.getElementById('message-sample2').addEventListener('click', () => {
                const msg = 'おまえもしかしてまだ...自分が死なないとでも思ってるんじゃないかね？';
                setMessage(msg);
                document.getElementById('message-input').value = msg;
            });
            
            // Enterキーでメッセージ反映
            document.getElementById('message-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    setMessage(e.target.value);
                }
            });
        });
        
        // ========================================
        // その他の機能
        // ========================================
        
        // インフォメーション表示切り替え
        document.addEventListener('keypress', (e) => {
            if (e.key === 'i' || e.key === 'I') {
                const overlay = document.getElementById('infoOverlay');
                overlay.classList.toggle('show');
            }
        });

        // 画像差し替え用のヘルパー関数
        function replaceCharacterImage(playerNum, imagePath) {
            const selector = playerNum === 1 ? '.character:first-child' : '.character:last-child';
            const character = document.querySelector(selector);
            if (character && imagePath) {
                character.style.backgroundImage = `url(${imagePath})`;
                character.style.backgroundSize = 'contain';
                character.style.backgroundPosition = 'center';
                character.style.backgroundRepeat = 'no-repeat';
                character.innerHTML = '';  // テキストをクリア
            }
        }

        // 使用例（コンソールから実行可能）
        // replaceCharacterImage(1, 'path/to/character1.png');
        // replaceCharacterImage(2, 'path/to/character2.png');

        // デバッグパネルの表示/非表示ショートカット（Ctrl+D）
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                const panel = document.getElementById('debug-control-panel');
                if (panel) {
                    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
                }
            }
        });

        // デバッグパネルの表示/非表示ショートカット（Ctrl+D）
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                const panel = document.getElementById('debug-control-panel');
                if (panel) {
                    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
                }
            }
        });
    </script>

    </div>

    <!-- コントロールパネル用のスタイル -->
    <style>
        #debug-control-panel button {
            padding: 2px 6px;
            margin: 2px;
            background: #333;
            color: #fff;
            border: 1px solid #666;
            cursor: pointer;
            font-size: 11px;
        }

        #debug-control-panel button:hover {
            background: #555;
            border-color: #888;
        }

        #debug-control-panel button:active {
            background: #222;
        }
    </style>
</body>
</html>